<!DOCTYPE html>
<html lang="ja">

<head>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kaisei+Decol&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Dela+Gothic+One&family=Diplomata+SC&family=Julius+Sans+One&family=Monomaniac+One&family=Noto+Serif+JP:wght@200..900&family=Shippori+Mincho&family=Shippori+Mincho+B1&family=Whisper&family=Yeseva+One&family=Zen+Kaku+Gothic+New&family=Zen+Kurenaido&family=Zen+Old+Mincho&display=swap"
    rel="stylesheet">
  <meta charset="UTF-8">
  <title>アカウント削除</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/delete.css">
</head>

<body class="centered-page">
  <img src="images/haikei.webp" alt="背景画像" class="background-img">

  <div class="delete-container">
    <h1 class="title-text">アカウント削除</h1>

    <div class="warning-message">
      <p>アカウントを削除すると、二度と戻れません。</p>
      <p>アカウント情報、手紙の履歴が消えてしまいます。</p>
    </div>

    <div class="confirmation-text">
      本当に削除して良いですか？
    </div>

    <div class="button-group">
      <button class="delete-btn" id="deleteBtn">
        同意して削除する
      </button>
    </div>
  </div>

  <script src="js/stars.js"></script>
  <script src="js/auth.js"></script>
  <script>
    // 認証チェック
    if (!isLoggedIn()) {
      alert('ログインが必要です');
      window.location.href = '4-login.html';
    }

    // 削除ボタン
    document.getElementById('deleteBtn').addEventListener('click', async () => {
      if (confirm('本当にアカウントを削除しますか？この操作は取り消せません。')) {
        try {
          const token = localStorage.getItem('token');
          const response = await fetch('http://localhost:3000/api/users/account', {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          if (response.ok) {
            // ローカルストレージをクリア
            localStorage.clear();
            
            // アラートを表示してからウェルカムページへ
            alert('アカウントを削除しました。ご利用ありがとうございました。');
            
            // ウェルカムページに遷移
            window.location.href = '0-welcome.html';
          } else {
            const error = await response.json();
            alert(error.error || 'アカウントの削除に失敗しました');
          }
        } catch (error) {
          console.error('削除エラー:', error);
          alert('アカウントの削除に失敗しました');
        }
      }
    });
  </script>
</body>

</html>